---
title: "良いコードを書くための小手先のテクニック"
---

## コメント

[^1]

- コードを眺めた時になるほどと思った場所をビーコンとしてコメントに残す。
- そのコードがなぜ必用なのかの視点でコメントを書く。

---

## 変数名の決め方

[^1]

1. 名前に含めるべき概念の選択: コメントを書くくらいなら変数名にその単語を入れる。
2. どんな単語を使うか: 各概念を表す同義語に注意する。
3. どう組み合わせるか: 自然言語としても自然な語順になるように単語を並べる。

[^2]

- 環境変数、定数を大文字にする。
- 変数に単位があるならば単位を示す。
- 適切な単語を使う。困ったら類語辞書を引く。
- 範囲の選択にはfirst,last,begin,endを使う。

### 変数の適切な省略の仕方

[^2]

- ConverttoString --> tostring
- 複数系の場合は略してもsを残す。Separators --> seps
- ingを削除する。
- 母音を削る。 image --> img
- 強い音を残す。server --> svr
- [略し方を検索できるサイト](https://www.allacronyms.com/)を使う

[^3]

- 名前は「効果」と「目的」を説明する。「手段」には言及しない
- 発音可能な名前にする
- ループバックチェック: 内容から名前を考えたあとに名前から内容を考えてみる。

---

## 実装時に気をつけること

[^3]

- 変数へは単一代入を意識して定数をなるべく使う。変更が必要なら別の変数を作る。

[^4]

- シンボリック変数を使う: 何を表しているかわかりにくい数値を説明する定数を作る/使う。

```lua
-- ngx.exit(401)
ngx.exit(ngx.HTTP_UNAUTHORIZED)
```

- シンメトリーを揃える: 同じ用途の処理を2つ以上のパータンで記載しない。

---

## 関数

[^3]

- 関数側で引数の調整をしない。呼び出す前に調整する。
- 関数の想定は厳格にする。想定外の引数が来たらエラーを返す。

[^4]

- 明示的なパラメータを使う。複数のパラメータを使う場合には分解する。

```lua
-- local user_data = {id = 1, name = "hoge"}
-- function get_user_info(user_data)
function get_user_info(user_id, user_name)
```

- ガード節を使う。
  - ガード節が7つ等は逆に読みにくい
  - ヘルパーメソッドとして抽出することを検討する

[^5]

- 良い関数名が思いつかない時には，良い設計でないかもしれない。

---

## テスト

### [プリンシプル オブ プログラミング](https://www.shuwasystem.co.jp/book/9784798046143.html)よりテスト

> テストがないコードのことを「レガシーコード」と呼びます。

## References

- [^1]: [プログラマー脳](https://www.shuwasystem.co.jp/book/9784798068534.html)
- [^2]: [リーダブルコード](https://www.oreilly.co.jp/books/9784873115658/)
- [^3]: [プリンシプル オブ プログラミング](https://www.shuwasystem.co.jp/book/9784798046143.html)
- [^4]: [Tidy First?](https://www.oreilly.co.jp/books/9784814400911/)
- [^5]: [テスト駆動開発 Kent Bech](https://shop.ohmsha.co.jp/shopdetail/000000004967/)
