---
title: "ã€å¤ä¼‘ã¿ã®è‡ªç”±ç ”ç©¶ã€‘Dev Containersã‚’ä½¿ã£ã¦é–‹ç™ºç’°å¢ƒã‚’ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã—ã¦ã¿ã‚ˆã†"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["devcontainer", "VSCode", "ã‚³ãƒ³ãƒ†ãƒŠ", "é–‹ç™ºç’°å¢ƒ"]
published: true
---


## è¨˜äº‹ã‚’æ›¸ã„ãŸç†ç”±
- ãƒªãƒã‚¸ãƒˆãƒªã¯ã“ã¡ã‚‰[devcontainer-test](https://github.com/RyosukeDTomita/devcontainer-test)
- Dev Containersã‚’é–‹ç™ºç¾å ´ã§å°å…¥ã™ã‚‹ã«ã‚ãŸã£ã¦å„ç¨®æ©Ÿèƒ½ã‚’è©¦ã—ã¦ãƒŠãƒ¬ãƒƒã‚¸ãŒæºœã¾ã£ãŸã®ã§Dev Containersã®æ©Ÿèƒ½ã‚’è©¦ã™ã‚ˆã†ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚

---

## Dev Containersã¨ã¯ãªã«ã‹

ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ç’°å¢ƒã‚’VSCodeã§ç¶­æŒã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
sshå…ˆã§VSCodeã‚’ä½¿ã†ã‚„ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚ˆã‚Šä¾¿åˆ©ãªæ©Ÿèƒ½ãŒãŸãã•ã‚“ã‚ã‚‹ã‚ˆã€œãã‚‰ã„ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒã£ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

### Dev Containersã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ

ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã†ã“ã¨ã§ãƒãƒ¼ãƒ ã§åŒã˜é–‹ç™ºç’°å¢ƒã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ãŒï¼ŒDev Containersã‚’ä½¿ã†ã“ã¨ã§ã‚ˆã‚ŠåŒã˜é–‹ç™ºç’°å¢ƒã‚’ä½¿ã†ã“ã¨ãŒã§ãï¼Œæ–°è¦é–‹ç™ºè€…ã®å‚ç”»ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ãŒå›³ã‚Œã¾ã™ã€‚
- VSCodeã®Extensionsã‚’Dev Containersä½¿ç”¨æ™‚ã«è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼†set upã§ãã‚‹
â†’Formatterã‚„linterï¼Œãã®ä»–å¿…è¦ãªExtensionsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è‡ªå‹•åŒ–ã§ãã‚‹ã€‚é‹ç”¨ã§Extensionsã‚’å°å…¥ã—ã¦ã‚‚ã‚‰ã†ã®ã§ã¯ãªãï¼Œä»•çµ„ã¿ã¨ã—ã¦Extensionsã‚’ãƒãƒ¼ãƒ å…¨ä½“ã§ä½¿ç”¨ã§ãã‚‹ã€‚
- Dockerfileå¤–ã§ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ãã‚‹
â†’Dockerfileã‚’æ±šã•ãšã«ï¼Œä½¿ç”¨ã™ã‚‹ãƒ‡ãƒãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ç­‰ã‚’ã‚³ãƒ³ãƒ†ãƒŠã§ç®¡ç†ã§ãã‚‹ã€‚
- Dev Containersç”¨ã®compose.yamlã‚’é…ç½®ã—ã¦ä½¿ãˆã‚‹ã®ãŒçµæ§‹ä¾¿åˆ©
â†’é–‹ç™ºç”¨ã®compose.yamlã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã®ã§æœ¬ç•ªç”¨ã®compose.yamlã‚’æ±šã•ãšã«ã™ã‚€ã€‚

---

## ä½œæˆã—ãŸæ¤œè¨¼ç”¨ãƒªãƒã‚¸ãƒˆãƒªã§å­¦ã¹ã‚‹ã“ã¨

æ¤œè¨¼ç”¨ãƒªãƒã‚¸ãƒˆãƒªâ†’[devcontainer-test](https://github.com/RyosukeDTomita/devcontainer-test)

### dotfilesã‚’ä½¿ã£ã¦é–‹ç™ºç’°å¢ƒã«å¿…è¦ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã¡è¾¼ã‚€

- ~/.bashrcç­‰ã‚’Dev Containersã«æŒã¡è¾¼ã‚€æ©Ÿèƒ½ã€‚
- **VSCodeã®å€‹äººç”¨ã®settings.json**ã«è¨˜è¼‰ã™ã‚‹ã€‚
- è¨­å®šã¯è‡ªåˆ†ã®GitHubä¸Šã§ç®¡ç†ã—ã¦ã„ã‚‹`dotfiles`ãƒªãƒã‚¸ãƒˆãƒªã«åˆã‚ã›ã¦å¤‰æ›´ã™ã‚‹ã“ã¨ã€‚

```json
  // Dev Containersã§dotfilesã‚’ä½¿ã†ã€‚
  // NOTE: .gitconfigã¯ä½•ã‚‚ã—ãªãã¦ã‚‚Dev Containersã®HOMEãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ã€‚
  "dotfiles.repository": "https://github.com/RyosukeDTomita/dotfiles.git",
  "dotfiles.targetPath": "~/dotfiles",
  "dotfiles.installCommand": "install.sh", // ~/dotfilesã®repository topã‹ã‚‰ã¿ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã€‚
```

> [!NOTE]
> `dotfiles.installCommand`ã«ã¯~/dotfilesã®repository topã‹ã‚‰è¦‹ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã€‚--> dotfilesã®GitHub Repositoryã«install.shã¯é…ç½®ãŒå¿…è¦ã€‚
> æŒ‡å®šã—ãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åã¯ä»¥ä¸‹ãŒèªè­˜ã•ã‚Œã‚‹ã€‚
> - install.sh
> - install
> - bootstrap.sh
> - setup.sh
> - setup

---

### Extensionsé–¢é€£

#### æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã“ã«ãŠãã‹
- devcontainer.jsonã¨.vscode/settings.jsonä¸¡æ–¹ã«è¨˜è¼‰ãŒã§ãã‚‹ã€‚
- åŸºæœ¬ã¯.vscode/settings.jsoné…ä¸‹ã§è‰¯ã„ã¨æ€ã£ã¦ã„ã‚‹ãŒä¸€éƒ¨ã‚³ãƒ³ãƒ†ãƒŠåç­‰ã‚’ä½¿ã†å ´åˆã«ã¯devcontainer.jsonã«è¨˜è¼‰ã—ãŸã»ã†ãŒæ¥½ã‹ã‚‚ã€‚

#### Extensionsã‚’è¿½ã™ã‚‹æ–¹æ³•

ä¾‹ãˆã°ï¼Œ[peacock](https://marketplace.visualstudio.com/items?itemName=johnpapa.vscode-peacock)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆã«ã¯ï¼Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰`ext install johnpapa.vscode-peacock`ã«ã¦è¨˜è¼‰ã•ã‚Œã‚‹`johnpapa.vscode-peacock`ã‚’devcontainer.jsonã«è¨˜è¼‰ã™ã‚Œã°ã‚ˆã„ã€‚

#### DevContainerã«è‡ªåˆ†ã ã‘ãŒä½¿ç”¨ã™ã‚‹Extensionsã‚’æŒã¡è¾¼ã‚€

- **å€‹äººç”¨ã®settings.json**ã«è¨˜è¼‰ã™ã‚‹ã€‚.vscode/settings.jsonã§ã¯ãªã„ã®ã§æ³¨æ„ã€‚

```json
  // Devcontainerã®å€‹äººçš„ã«ä½¿ã†Extensionsã‚’å…¥ã‚Œã‚‹ã€‚
  "dev.containers.defaultExtensions": [
    "formulahendry.auto-rename-tag",
  ],
}
```

---

### Dockerfileã®ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚’ä½¿ã£ã¦DevContainerç”¨ã®ç’°å¢ƒã‚’ä½œã‚‹

- Dockerfileã‚’ä½¿ã†å ´åˆã«ã¯devcontainer.jsonã§targetã®æŒ‡å®šãŒã§ãã‚‹ã€‚
- ä¸€æ–¹ï¼Œcompose.yamlã‚’ä½¿ã†å ´åˆã«ã¯åˆ¥ã®compose.yamlã‚’æº–å‚™ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

> [!NOTE]
> compose.yamlã®å„ªå…ˆé †ä½ã¯.devcontainer/compose.yamlãŒå„ªå…ˆã•ã‚Œã‚‹ã€‚

```yaml
# for devcontainer
version: '3'

services:
  react-app:
    build:
      target: devcontainer // targetã‚’æŒ‡å®š
      context: ./
      dockerfile: Dockerfile
    image: react-img-devcontainer:latest
    container_name: react-container-devcontainer
    ports:
      - 80:8080 # localport:dockerport
```

```
# DevContainer
FROM node:20-bullseye AS devcontainer # targetã«æŒ‡å®šã™ã‚‹å€¤
WORKDIR /app
COPY . .
RUN cd react-default-app && npm install

# Build Image
FROM node:20-bullseye AS build
WORKDIR /app
COPY ./react-default-app .
RUN npm install && npm run build
```

> [!NOTE]
> - compose.yamlã®ã‚µãƒ¼ãƒ“ã‚¹åã‚’devcontainer.jsonã®serviceã‚’åŒã˜ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```yaml
# compose.yaml
version: '3'

services:
  react-app: # devcontainer.jsonã«æŒ‡å®šã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹å
    build:
      target: devcontainer
      context: ./
      dockerfile: Dockerfile
    image: react-img-devcontainer:latest
    container_name: react-container-devcontainer
    ports:
      - 80:8080 # localport:dockerport
```

```json
{
  "name": "dev-container-test", // ä»»æ„ã®åå‰
  "dockerComposeFile": [
    "../compose.yaml",
    "compose.yaml"
  ],
  "service": "react-app", // compose.yamlã®ã‚µãƒ¼ãƒ“ã‚¹å
```

> [å‚è€ƒ1](https://github.com/microsoft/vscode-remote-release/issues/7810)
> [å‚è€ƒ2](https://stackoverflow.com/questions/78421879/devcontainer-docker-compose-best-practice)

---

### å„ç¨®ã‚³ãƒãƒ³ãƒ‰ã®ä½¿ã„æ–¹

```json
{
  "name": "dev-container-test",
  "dockerComposeFile": [
    "../compose.yaml",
    "compose.yaml"
  ],
  "service": "react-app",
  "workspaceFolder": "/app",
  "overrideCommand": true, // ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãŸã¾ã¾ã«ã™ã‚‹ Dockerfileã®CMDã§æ°¸ç¶šã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãªã‚‰ä¸è¦
  // rvest.vscode-prettier-eslintã«ä½¿ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’install
  "postCreateCommand": "yarn add -D prettier@^3.1.0 eslint@^8.52.0 prettier-eslint@^16.1.2 @typescript-eslint/parser@^5.0.1 typescript@^4.4.4",
  "postStartCommand": ["echo", "Hello, DevContainer"], // DevContainerèµ·å‹•æ™‚
  "postAttachCommand": ["echo", "Hello, DevContainer"], // DevContainerã«æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠã‚’attachæ™‚
  "initializeCommand": ["echo", "Starting DevContainer..."], // DevContainerã®ãƒ“ãƒ«ãƒ‰å‰ï¼Œå®Ÿè¡Œå‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰
```

#### installã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ã†

å¿…è¦ãã†ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã¾ã¨ã‚ãŸ`install-pkg.sh`ã‚’ä½œæˆã—ï¼ŒpostCreateCommandã§å®Ÿè¡Œã™ã‚‹ã€‚

---

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒã‚¦ãƒ³ãƒˆ

- ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½“ã§ã®ãƒã‚¦ãƒ³ãƒˆã¯ã§ããªã„ã½ã„ã€‚è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‹ã¯å‰è¿°ã®dotfilesã‚’ä½¿ã£ã¦å…±æœ‰ã™ã‚‹ã€‚

```json
{
  "name": "dev-container-test",
  "dockerComposeFile": [
    "../compose.yaml",
    "compose.yaml"
  ],
  "service": "react-app",
  "workspaceFolder": "/app",
  "overrideCommand": true,
  "mounts": [
    "source=~/.aws,target=/home/root/.aws,type=bind" // ~/.awsã‚’ãƒã‚¦ãƒ³ãƒˆã§ãã‚‹
  ],
```
